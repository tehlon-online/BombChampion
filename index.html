<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Arrow Sequence Game</title>
    <style>
        body {
            background-color: #f0f0f0;
            font-family: 'Arial', sans-serif;
            text-align: left;
            margin: 0;
            padding: 0;
        }
        #container {
            width: 500px;
            margin: 50px 0 50px 20px;
            box-sizing: border-box;
        }
        #game-container, .link-box {
            width: 500px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #cccccc; /* Changed to a slightly darker shade */
            border: 2px solid black;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            box-sizing: border-box;
        }
        #sequence {
            font-size: 40px;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: nowrap;
            overflow-x: auto;
        }
        .arrow {
            font-size: 40px;
            color: black;
            transition: color 0.3s;
        }
        .correct {
            color: #00FF00;
        }
        #timer {
            font-size: 20px;
            color: red;
            margin-bottom: 10px;
        }
        #game-over {
            display: none;
            font-size: 30px;
            color: red;
            margin-top: 20px;
            text-align: center;
        }
        .game-button {
            padding: 10px 20px;
            font-size: 18px;
            background-color: #2e2e2e;
            color: white;
            border: none;
            cursor: pointer;
            margin: 10px;
        }
        .game-button:hover {
            background-color: #45a049;
        }

        #countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 60px;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #countdown-text {
            font-size: 30px;
            margin-bottom: 20px;
        }

        .link-box {
            background-color: #cccccc; /* Changed to a slightly darker shade */
            border: 2px solid #000;
            padding: 10px;
            text-align: left;
        }
        .link-box a {
            color: #007BFF;
            text-decoration: none;
            font-weight: bold;
        }
        #title-bar {
            background-color: #2e2e2e;
            color: white;
            padding: 5px 10px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 3px 3px 0 0;
            margin: -10px -10px 10px;
        }
        #game-container #title-bar {
            margin: -20px -20px 10px;
        }
        .game-over-gif {
            margin-top: 20px;
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1 style="margin-bottom: 0; padding-left: 20px;">Tehlon.com</h1>
    <p style="font-size: 15px; margin-top: 0; padding-left: 20px;">
        <em>This is a silly website just for fun</em>
    </p>

    <div id="container">
        <!-- Dumb Projects Box -->
        <div class="link-box">
            <div id="title-bar">GoPlaces</div> <!-- Changed title here -->
            <p style="font-size: 14px; padding-left: 10px;"></p>
            <p><a href="https://tehlon-online.github.io/Home/" target="_blank">Home</a></p>
        </div>

        <!-- Game Area -->
        <div id="game-container">
            <div id="title-bar">BombChampion</div>
            <div id="timer">Time: 0s</div>
            <div id="sequence"></div>
            <p>Use Arrow Keys or WASD</p>
            <button id="start-btn" class="game-button">Start Game</button>
            <div id="game-over">
                <div id="game-over-stars"></div>
                <div id="game-over-message"></div>
                <img id="game-over-gif" class="game-over-gif" src="" alt="Game Over GIF">
            </div>
            <button id="try-again-btn" class="game-button" style="display: none;" onclick="location.reload()">Try Again</button>
            <div id="countdown-overlay">
                <div id="countdown-text"></div>
                <div id="countdown-number">3</div>
            </div>
        </div>
    </div>

    <script>
        const arrowMap = { 'ArrowUp': '⬆', 'ArrowDown': '⬇', 'ArrowLeft': '⬅', 'ArrowRight': '➡',
                           'w': '⬆', 's': '⬇', 'a': '⬅', 'd': '➡' };
        let sequence = [];
        let userInput = [];
        let round = 1;
        let sequencesPerRound = 5;
        let timeLeft = 20;
        let timer;
        let countdownTimer;
        let gameStarted = false;
        let countdownOverlay = document.getElementById("countdown-overlay");
        let startButton = document.getElementById("start-btn");

        startButton.addEventListener('click', function() {
            startButton.style.display = 'none';
            startRound();
        });

        function generateSequence() {
            sequence = [];
            let sequenceLength = getSequenceLength(round);
            for (let i = 0; i < sequenceLength; i++) {
                let keys = Object.values(arrowMap);
                sequence.push(keys[Math.floor(Math.random() * 4)]);
            }
            updateSequenceDisplay();
            userInput = [];
        }

        function updateSequenceDisplay() {
            const sequenceContainer = document.getElementById("sequence");
            sequenceContainer.innerHTML = '';
            sequence.forEach(arrow => {
                const arrowElement = document.createElement('div');
                arrowElement.classList.add('arrow');
                arrowElement.textContent = arrow;
                sequenceContainer.appendChild(arrowElement);
            });
        }

        function startRound() {
            document.getElementById("countdown-text").textContent = `Round ${round}`;
            clearInterval(countdownTimer);
            countdownStart();
        }

        function countdownStart() {
            let countdown = 3;
            countdownOverlay.style.display = 'flex';
            document.getElementById("countdown-number").textContent = countdown;
            countdownTimer = setInterval(() => {
                countdown--;
                document.getElementById("countdown-number").textContent = countdown > 0 ? countdown : "Go!";
                if (countdown === 0) {
                    clearInterval(countdownTimer);
                    setTimeout(() => {
                        countdownOverlay.style.display = 'none';
                        startGame();
                    }, 1000);
                }
            }, 1000);
        }

        function startGame() {
            gameStarted = true;
            generateSequence();
            timeLeft = getRoundTime(round);
            sequencesPerRound = getSequencesPerRound(round);
            document.getElementById("timer").textContent = `Time: ${timeLeft}s`;
            timer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            if (!gameStarted || timeLeft === 0) return;  // Don't update timer if the game isn't started or if it's 0.

            timeLeft--;
            document.getElementById("timer").textContent = `Time: ${timeLeft}s`;

            if (timeLeft <= 0) {
                clearInterval(timer);
                timeLeft = 0;
                document.getElementById("timer").textContent = `Time: ${timeLeft}s`;
                showGameOver();
            }
        }

        function handleKeyPress(event) {
            if (!gameStarted) return;
            
            if (arrowMap[event.key]) {
                userInput.push(arrowMap[event.key]);

                if (userInput.join(" ") === sequence.join(" ")) {
                    sequencesPerRound--;
                    flashGreen();
                    if (sequencesPerRound === 0) {
                        round++;
                        freezeTimer();  // Freeze timer at 0 until countdown for next round
                        startRound();
                    } else {
                        generateSequence();
                    }
                } else if (!sequence.join(" ").startsWith(userInput.join(" "))) {
                    userInput = [];
                    flashRed();
                    resetArrows();
                } else {
                    markCorrectInput();
                }
            }
        }

        function markCorrectInput() {
            const sequenceContainer = document.getElementById("sequence");
            const arrowElements = sequenceContainer.querySelectorAll('.arrow');
            userInput.forEach((input, index) => {
                if (input === sequence[index]) {
                    arrowElements[index].classList.add('correct');
                }
            });
        }

        function resetArrows() {
            const sequenceContainer = document.getElementById("sequence");
            const arrowElements = sequenceContainer.querySelectorAll('.arrow');
            arrowElements.forEach(arrow => {
                arrow.classList.remove('correct');
            });
        }

        function flashGreen() {
            const sequenceContainer = document.getElementById("sequence");
            sequenceContainer.style.backgroundColor = '#00FF00';
            setTimeout(() => {
                sequenceContainer.style.backgroundColor = '';
            }, 50);
        }

        function flashRed() {
            const sequenceContainer = document.getElementById("sequence");
            sequenceContainer.style.backgroundColor = '#FF0000';
            setTimeout(() => {
                sequenceContainer.style.backgroundColor = '';
            }, 50);
        }

        function showGameOver() {
            let gameOverMessage = '';
            let stars = '';
            let gifSrc = '';
            
            // Map the round number to a specific message, star rating, and GIF
            switch (round) {
                case 6:
                    gameOverMessage = "Outstanding Patriotism";
                    stars = '★★★★★'; // 5 stars for Round 6
                    gifSrc = '5star.gif';
                    break;
                case 5:
                    gameOverMessage = "Superior Valor";
                    stars = '★★★★☆'; // 4 stars for Round 5
                    gifSrc = '4star.gif';
                    break;
                case 4:
                    gameOverMessage = "Honorable Duty";
                    stars = '★★★☆☆'; // 3 stars for Round 4
                    gifSrc = '3star.gif';
                    break;
                case 3:
                    gameOverMessage = "Unremarkable Performance";
                    stars = '★★☆☆☆'; // 2 stars for Round 3
                    gifSrc = '2star.gif';
                    break;
                case 2:
                    gameOverMessage = "Disappointing Service";
                    stars = '★☆☆☆☆'; // 1 star for Round 2
                    gifSrc = '1star.gif';
                    break;
                case 1:
                    gameOverMessage = "Failed to Extract";
                    stars = '☆☆☆☆☆'; // No stars for Round 1 loss
                    gifSrc = '0star.gif';
                    break;
                default:
                    gameOverMessage = "Failed to Extract";
                    stars = '☆☆☆☆☆'; // No stars for an undefined case
                    gifSrc = '0star.gif';
                    break;
            }
            
            // Update the game over message, stars, and GIF
            document.getElementById("game-over-stars").textContent = stars;
            document.getElementById("game-over-message").textContent = gameOverMessage;
            document.getElementById("game-over-gif").src = gifSrc;
            document.getElementById("game-over").style.display = 'block';
            document.getElementById("try-again-btn").style.display = 'inline-block';
        }

        function freezeTimer() {
            clearInterval(timer);
            document.getElementById("timer").textContent = `Time: 0s`;
        }

        function getSequenceLength(round) {
            const roundSequenceLengths = {
                1: [3, 5],
                2: [3, 6],
                3: [4, 6],
                4: [4, 7],
                5: [4, 8],
                6: [5, 8]
            };

            const [min, max] = roundSequenceLengths[round] || [3, 5];
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRoundTime(round) {
            return 13 + (round * 2);
        }

        function getSequencesPerRound(round) {
            return round + 4;
        }

        window.addEventListener('keydown', handleKeyPress);
    </script>
</body>
</html>